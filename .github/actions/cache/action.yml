name: Cache
description: Runs the kernel-packer cache step

runs:
  using: composite
  steps:
    - name: Combine cache
      run: make combine-cache
      shell: bash

    - name: Clean cache
      run: make clean-cache
      shell: bash

    - name: Upload cache
      run: |
        IFS=',' read -r -a bucket_names <<< "${KERNEL_BUNDLE_BUCKET}"
        gsutil cp .build-data/cache/cache.yml "${bucket_names[0]}/cache.yml"
      shell: bash
